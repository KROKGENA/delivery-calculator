<script>
ymaps.ready(function () {
    const warehouseCoords = [54.907129, 38.054109]; // Координаты склада
    let map = new ymaps.Map("map", {
        center: warehouseCoords,
        zoom: 12
    });

    // Метка склада
    let warehousePlacemark = new ymaps.Placemark(warehouseCoords, {
        iconCaption: 'Склад'
    }, {
        preset: 'islands#greenDotIconWithCaption'
    });
    map.geoObjects.add(warehousePlacemark);

    let clientPlacemark = null;
    let route = null;

    // Клик по карте
    map.events.add('click', function (e) {
        const coords = e.get('coords');

        // Удаляем старую метку клиента
        if (clientPlacemark) {
            map.geoObjects.remove(clientPlacemark);
        }

        // Ставим метку клиента
        clientPlacemark = new ymaps.Placemark(coords, {
            iconCaption: 'Клиент'
        }, {
            preset: 'islands#redDotIconWithCaption'
        });
        map.geoObjects.add(clientPlacemark);

        // Определяем адрес по координатам
        ymaps.geocode(coords).then(function (res) {
            const firstGeoObject = res.geoObjects.get(0);
            const address = firstGeoObject ? firstGeoObject.getAddressLine() : 'Адрес не найден';
            document.getElementById('address').value = address;
        });

        // Удаляем старый маршрут
        if (route) {
            map.geoObjects.remove(route);
        }

        // Строим новый маршрут
        ymaps.route([warehouseCoords, coords]).then(function (newRoute) {
            route = newRoute;
            map.geoObjects.add(route);
            map.setBounds(route.getBounds(), { checkZoomRange: true });
        }).catch(function (error) {
            alert("Не удалось построить маршрут: " + error.message);
        });
    });
});
</script>
